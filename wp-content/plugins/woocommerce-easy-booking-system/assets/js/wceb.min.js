var wceb={productType:wceb_object.product_type,calcMode:wceb_object.calc_mode,maxOption:new Date(wceb_object.last_date+"T00:00:00"),firstWeekday:wceb_object.first_weekday,allowDisabled:wceb_object.allow_disabled,session:!1,checkIf:{isDate:null,isDay:null,isArray:null,isObject:null,isDisabled:null,dateIsSet:null,datesAreSet:null},get:{firstAvailableDate:null,basePrice:null,additionalCosts:null,childrenIds:null,minAndMax:null,closestDisabled:null,closest:null},createDateObject:null,clearBookingSession:null,applyBookingDuration:null,formatPrice:null,setPrice:null,picker:{close:null,set:null},pickers:{init:null,render:null,reset:null,clearSecond:null,set:null}};!function(e){e(document).ready(function(){ajax_url=("https:"===location.protocol?"https:":"http:")+wceb_object.ajax_url,$body=e("body"),$cart=e(".cart"),$qty_input=$cart.find('input[name="quantity"]'),$booking_price=e(".booking_price"),$add_to_cart_button=e(".single_add_to_cart_button"),$reset_dates=e("a.reset_dates"),product_id=e("input[name=add-to-cart], button[name=add-to-cart]").val(),$variation_input=e(".variations_form").find("input[name=variation_id]"),$inputStart=e(".datepicker_start").pickadate(),pickerStart=$inputStart.pickadate("picker"),pickerStartItem=pickerStart.component.item,$inputEnd=e(".datepicker_end").pickadate(),pickerEnd=$inputEnd.pickadate("picker"),pickerEndItem=pickerEnd.component.item;var t={startFormat:null,endFormat:null};wceb.checkIf.isDate=function(e){return e instanceof Date},wceb.checkIf.isDay=function(e){return!isNaN(e)&&e>=1&&e<=7},wceb.checkIf.isArray=function(e){return e instanceof Array},wceb.checkIf.isObject=function(e){return"object"==typeof e&&!(e instanceof Date)},wceb.checkIf.isDisabled=function(t,a){if("undefined"==typeof t)return!1;var r=!1,c=a.pick;return e.each(t,function(e,t){if(wceb.checkIf.isArray(t)){if(t=new Date(t[0],t[1],t[2]),c===t.getTime())return void(r=!0)}else if(wceb.checkIf.isObject(t)){if(start=new Date(t.from[0],t.from[1],t.from[2]),end=new Date(t.to[0],t.to[1],t.to[2]),c>=start.getTime()&&c<=end.getTime())return void(r=!0)}else if(wceb.checkIf.isDay(t)){var i=a.day;if(0===i?i=7:"1"!==wceb.firstWeekday&&(i-=1),t===i)return void(r=!0)}else if(wceb.checkIf.isDate(t)&&c===t.getTime())return void(r=!0)}),r},wceb.checkIf.dateIsSet=function(e){if("start"===e)var e=pickerStart.get("select");else if("end"===e)var e=pickerEnd.get("select");return"undefined"!=typeof e&&null!==e},wceb.checkIf.datesAreSet=function(){var e=pickerStart.get("select"),t=pickerEnd.get("select");return null!==e&&"undefined"!=typeof e&&null!==t&&"undefined"!=typeof t},wceb.get.firstAvailableDates=function(){var e={},t=+parseInt(wceb.firstDate);if(t<=0)var t=!1;for(var a=wceb.createDateObject(!1,t),r=pickerStartItem.disable;!0===wceb.checkIf.isDisabled(r,a);)var a=wceb.createDateObject(a.obj,1);if(e.start=a,"two"===wceb.dateFormat){for(var c=new Date(a.pick),i=wceb.createDateObject(c,wceb.bookingMin),n=pickerEndItem.disable;!0===wceb.checkIf.isDisabled(n,i);)var i=wceb.createDateObject(i.obj,1);e.end=i}return e},wceb.get.basePrice=function(){if($qty_input.length)var e=parseFloat($qty_input.val());else var e=1;var t=parseFloat($booking_price.attr("data-booking_price")),a="two"===wceb.dateFormat&&!wceb.checkIf.datesAreSet()||"one"===wceb.dateFormat&&!wceb.checkIf.dateIsSet("start")?wceb.get.additionalCosts():0,r=parseFloat((a+t)*e);return r},wceb.get.regularPrice=function(){if($qty_input.length)var e=parseFloat($qty_input.val());else var e=1;var t=parseFloat($booking_price.attr("data-booking_regular_price")),a="two"===wceb.dateFormat&&!wceb.checkIf.datesAreSet()||"one"===wceb.dateFormat&&wceb.checkIf.dateIsSet("start")?wceb.get.additionalCosts():0,r=parseFloat((a+t)*e);return r},wceb.get.additionalCosts=function(t){var a=0,r={};return"bundle"===wceb.productType&&"each"===t?$selector=e(".product").find("form.cart").find(".cart"):"bundle"===wceb.productType&&"each"!==t?$selector=e(".product").find(".cart.bundle_data"):$selector=e(".product").find("form.cart"),$selector.each(function(){e(this).find(".addon, .wc-pao-addon-field").each(function(){var t=0,c=e(this),i=c.parents(".cart");if("undefined"!=typeof i.data("bundle_id"))var n=i.data("product_id"),o=i.data("bundled_item_id"),d=i.find('input[name="bundle_variation_id_'+o+'"]').val(),s="undefined"==typeof d?n:d;if(c.is(".addon-custom-price, .wc-pao-addon-custom-price")?t=c.val():c.is(".addon-input_multiplier, .wc-pao-addon-input_multiplier")?(isNaN(c.val())||""==c.val()?(c.val(""),c.closest("p").find(".addon-alert").show()):(""!=c.val()&&c.val(Math.ceil(c.val())),c.closest("p").find(".addon-alert").hide()),t=c.data("price")*c.val()):c.is(".addon-checkbox, .wc-pao-addon-checkbox, .addon-radio, .wc-pao-addon-radio")?c.is(":checked")&&(t=c.data("price")):c.is(".addon-select, .wc-pao-addon-select")?c.val()&&(t=c.find("option:selected").data("price")):c.val()&&(t=c.data("price")),t||(t=0),a+=t,"undefined"==typeof s)var l=$variation_input.val(),s="undefined"!=typeof l?l:product_id;if("undefined"!=typeof s&&""!==s){var b=c.attr("name"),p=b.replace(/ *\[[^\]]*]/,"").replace("addon-","");if("undefined"!=typeof o)var p=p.replace(o+"-",s+"-");r.hasOwnProperty(p)?r[p].push(t):r[p]=[t]}})}),"each"===t?r:a},wceb.get.childrenIds=function(){var t={};if("grouped"===wceb.productType){var a=wceb_object.children;e.each(a,function(a,r){$child_input=e('input[name="quantity['+r+']"]'),$child_input.is(".wc-grouped-product-add-to-cart-checkbox")?$child_input.is(":checked")?quantity=1:quantity=0:quantity=$child_input.val(),quantity>0&&(t[r]=quantity)})}else if("bundle"===wceb.productType){var r=e(".cart.bundle_data"),c=r.data("bundle_id");if(r.find('input[name="quantity"]').length)var i=r.find('input[name="quantity"]').val();else var i=1;t[c]=i;var n=$body.find(".bundled_product .cart");n.each(function(){$this=e(this),optional=$this.data("optional"),bundle=$this.data("bundled_item_id"),child=$this.data("product_id"),variation=$this.find('input[name="bundle_variation_id_'+bundle+'"]').val(),quantity=$this.find(".bundled_qty").val();var a="undefined"==typeof variation?child:variation;if("yes"===optional){var r=e('input[name="bundle_selected_optional_'+bundle+'"]').is(":checked");!1===r&&(quantity=0)}""!==a&&quantity>0&&(t[a]=quantity)})}return t},wceb.get.minAndMax=function(e,t){var a=new Date(e.year,e.month,e.date),r=new Date(e.year,e.month,e.date),c=wceb.get.firstAvailableDates(),i="minus"===t?c.start.obj:c.end.obj;if("minus"===t&&""===wceb.bookingMax)var a=i;"plus"===t?(a.setDate(a.getDate()+wceb.bookingMin),""!==wceb.bookingMax&&r.setDate(r.getDate()+wceb.bookingMax)):(r.setDate(r.getDate()-wceb.bookingMin),""!==wceb.bookingMax&&a.setDate(a.getDate()-wceb.bookingMax)),i>a&&(a=i),"plus"===t&&""===wceb.bookingMax&&(r=!1),(!r||wceb.maxOption<r)&&(r=wceb.maxOption);var n={};return n.min=a,n.max=r,n},wceb.get.closestDisabled=function(t,a,r){var c=new Date(t),i=c.getDay(),n=a.get("disable"),o=[];e.each(n,function(e,a){if(wceb.checkIf.isArray(a)){if("booked"===a.type||"no"===wceb.allowDisabled){var n=new Date(a[0],a[1],a[2]);o.push(n.getTime())}}else if(wceb.checkIf.isObject(a)){if("superior"===r)var n=new Date(a.from[0],a.from[1],a.from[2]);else var n=new Date(a.to[0],a.to[1],a.to[2]);"booked"!==a.type&&"no"!==wceb.allowDisabled||o.push(n.getTime())}else if(wceb.checkIf.isDate(a))o.push(a.getTime());else if("no"===wceb.allowDisabled&&wceb.checkIf.isDay(a))if("superior"===r){var d=Math.abs(i-a);0===d&&(d=7),a<i&&7!==d&&(d=7-d);var s=c.setDate(c.getDate()+d);o.push(s),c=new Date(t)}else if("inferior"===r){var d=Math.abs(i-a);0===d&&(d=7),i<a&&7!==d&&(d=7-d),previousDisabledDay=c.setDate(c.getDate()-d),o.push(previousDisabledDay)}}),o.sort();var d=wceb.get.closest(o,t,r);return d},wceb.get.closest=function(e,t,a){minClosest=!1;for(var r=0;r<e.length;r++)if("superior"===a){if(e[r]>t){minClosest=e[r];break}minClosest=!1}else"inferior"===a&&e[r]<t&&(minClosest=e[r]);return minClosest},wceb.createDateObject=function(e,t){var a={};if(!e)var e=new Date;if(t&&e.setDate(e.getDate()+t),"infinity"===e){var a={date:1/0,day:1/0,month:1/0,obj:1/0,pick:1/0,year:1/0};return a}if(!wceb.checkIf.isDate(e))return a;e.setHours(0,0,0,0);var a={date:e.getDate(),day:e.getDay(),month:e.getMonth(),obj:e,pick:e.getTime(),year:e.getFullYear()};return a},wceb.clearBookingSession=function(){if(wceb.session){var t={security:document.getElementsByName("_wceb_nonce")[0].value};e.post(ajax_url.toString().replace("%%endpoint%%","clear_booking_session"),t,function(e){wceb.session=e})}$booking_price.find(".price").html(""),e(".booking_details").html(""),$add_to_cart_button.prop("disabled",!0)},wceb.applyBookingDuration=function(e,t,a){var r=t.disable,c="end"===e?t.max:t.min,i=new Date(a.year,a.month,a.date),n=t.view,o=new Date(n.year,n.month,0).getDate(),d=new Date(n.year,n.month+1,0).getDate(),s=new Date(n.year,n.month+2,0).getDate(),l=parseInt(o+d+s),b=Math.abs(Math.round((n.pick-a.pick)/864e5)),p="end"===e?parseInt(b-o):parseInt(b-d-s),u="end"===e?parseInt(b-o+l):parseInt(b-s+l);if("end"===e&&b<o)var p=wceb.bookingCustomDuration,u=parseInt(b+d+s);if("start"===e&&p<s)var p=wceb.bookingCustomDuration,u=parseInt(b+d+o);if(p<0&&(p=0),p<wceb.bookingCustomDuration)p=wceb.bookingCustomDuration;else{var f,m=[];for(f=0;f<=p;f+=wceb.bookingCustomDuration)m.push(f);var p=m.slice(-1)[0]}"days"===wceb.calcMode&&(p-=1);var w,k=[1,2,3,4,5,6,7];for(first=!1,w=p;w<=u;w+=wceb.bookingCustomDuration){var _=new Date(a.year,a.month,a.date);if("start"===e?_.setDate(i.getDate()-w):"end"===e&&_.setDate(i.getDate()+w),dateToEnable=wceb.createDateObject(_),"end"===e&&dateToEnable.obj>c.obj||"start"===e&&dateToEnable.obj<c.obj)break;if("undefined"!=typeof r&&r.length>0)var g=wceb.checkIf.isDisabled(r,dateToEnable);!0!==g&&k.push([dateToEnable.year,dateToEnable.month,dateToEnable.date,"inverted"])}return t.disable=r.concat(k),!1},wceb.formatPrice=function(e){return formatted_price=accounting.formatMoney(e,{symbol:wceb_object.currency_format_symbol,decimal:wceb_object.currency_format_decimal_sep,thousand:wceb_object.currency_format_thousand_sep,precision:wceb_object.currency_format_num_decimals,format:wceb_object.currency_format}),formatted_price},wceb.setPrice=function(){var a=$variation_input.val();children=wceb.get.childrenIds(),t={};e.fn.pickadate.defaults.format;t.startFormat=pickerStart.get("select","yyyy-mm-dd"),t.endFormat=pickerEnd.get("select","yyyy-mm-dd");var r=wceb.get.additionalCosts("each"),c={security:document.getElementsByName("_wceb_nonce")[0].value,product_id:product_id,variation_id:a,children:children,start_format:t.startFormat,end_format:t.endFormat,additional_cost:r};e("form.cart, form.bundle_form").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent",backgroundSize:"16px 16px",opacity:.6}}),e.post(ajax_url.toString().replace("%%endpoint%%","add_new_price"),c,function(t){if(e(".woocommerce-error, .woocommerce-message").remove(),fragments=t.fragments,error=t.error,error)return e(".wceb_picker_wrap").prepend('<div class="wceb_error woocommerce-error">'+error+"</div>"),wceb.pickers.reset(),$reset_dates.hide(),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock(),!1;if(fragments){if(e.each(fragments,function(t,a){e(t).replaceWith(a)}),$qty_input.length)var a=parseFloat($qty_input.val());else var a=1;var r=wceb.formatPrice(fragments.booking_price*a),i='<span class="woocommerce-Price-amount amount">'+r+"</span>";if(""!==fragments.booking_regular_price){var n=wceb.formatPrice(fragments.booking_regular_price*a),i='<del><span class="woocommerce-Price-amount amount">'+n+'</span></del> <ins><span class="woocommerce-Price-amount amount">'+r+"</span></ins>";$booking_price.attr("data-booking_regular_price",fragments.booking_regular_price)}$booking_price.attr("data-booking_price",fragments.booking_price).find(".price").html(i),wceb.session=fragments.session}$body.trigger("update_price",[c,t]),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock()})},wceb.picker.set=function(){var a=$variation_input.val();children=wceb.get.childrenIds(),t.startFormat=pickerStart.get("select","yyyy-mm-dd");var r={security:document.getElementsByName("_wceb_nonce")[0].value,product_id:product_id,variation_id:a,children:children,start_format:t.startFormat,additional_cost:wceb.get.additionalCosts("each")};e("form.cart, form.bundle_form").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent",backgroundSize:"16px 16px",opacity:.6}}),e.post(ajax_url.toString().replace("%%endpoint%%","add_new_price"),r,function(t){if(e(".woocommerce-error, .woocommerce-message").remove(),fragments=t.fragments,error=t.error,error)return e(".wceb_picker_wrap").prepend('<div class="wceb_error woocommerce-error">'+error+"</div>"),wceb.pickers.reset(),$reset_dates.hide(),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock(),!1;if(fragments){if(e.each(fragments,function(t,a){e(t).replaceWith(a)}),fragments.booking_price){if($qty_input.length)var a=parseFloat($qty_input.val());else var a=1;var c=wceb.formatPrice(fragments.booking_price*a),i='<span class="woocommerce-Price-amount amount">'+c+"</span>";if(""!==fragments.booking_regular_price){var n=wceb.formatPrice(fragments.booking_regular_price*a),i='<del><span class="woocommerce-Price-amount amount">'+n+'</span></del> <ins><span class="woocommerce-Price-amount amount">'+c+"</span></ins>";$booking_price.attr("data-booking_regular_price",fragments.booking_regular_price)}$booking_price.attr("data-booking_price",fragments.booking_price).find(".price").html(i)}wceb.session=fragments.session}$body.trigger("update_price",[r,t]),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock()})},wceb.picker.close=function(t,a){if(e(document.activeElement).blur(),"two"===wceb.dateFormat){var r=t.get("select"),c=a.get("select");wceb.checkIf.dateIsSet(r)&&!wceb.checkIf.dateIsSet(c)&&setTimeout(function(){a.open()},250)}},wceb.pickers.init=function(){pickerStartItem.disable=[],"two"===wceb.dateFormat&&(pickerEndItem.disable=[]);var e=wceb.get.firstAvailableDates(),t=e.start,a=t,r=wceb.createDateObject(wceb.maxOption),c=wceb.createDateObject(new Date(a.year,a.month,1));if(pickerStartItem.clear=null,pickerStartItem.select=void 0,pickerStartItem.min=a,pickerStartItem.max=r,pickerStartItem.highlight=a,pickerStartItem.view=c,pickerStart.$node.val(""),"two"===wceb.dateFormat){var i=e.end,n=i,o=wceb.createDateObject(new Date(n.year,n.month,1));pickerEndItem.clear=null,pickerEndItem.select=void 0,pickerEndItem.min=n,pickerEndItem.max=r,pickerEndItem.highlight=n,pickerEndItem.view=o,pickerEnd.$node.val("")}return $add_to_cart_button.prop("disabled",!0),!1},wceb.pickers.render=function(e){$body.trigger("pickers_init",e),pickerStart.render(),pickerEnd.render(),$body.trigger("after_pickers_init",e)},wceb.pickers.reset=function(){if(wceb.pickers.init(),"variable"===wceb.productType){var e=$variation_input.val(),t={};t.variation_id=e,wceb.pickers.render(t)}else if("grouped"===wceb.productType||"bundle"===wceb.productType){var a=$reset_dates.attr("data-ids");wceb.pickers.render(JSON.parse(a))}else wceb.pickers.render()},wceb.pickers.clearSecond=function(e,t,a){var r=a.component.item,c=wceb.get.firstAvailableDates(),i=c[t],n=wceb.createDateObject(wceb.maxOption),o=wceb.createDateObject(new Date(i.year,i.month,1));r.disable=[],r.min=i,r.max=n,null===a.get("select")&&(r.highlight=i,r.view=o),$body.trigger("clear_"+e+"_picker",r),a.render()},wceb.pickers.set=function(e,t,a,r){var c=t.get("select"),i=a.get("select");if(null!==c){var n="start"===e?"superior":"inferior",o="start"===e?"plus":"minus",d=c.pick,s=wceb.get.minAndMax(c,o),l=s.min,b=s.max,p="start"===e?b:l;b||(b=wceb.maxOption);var u=wceb.get.closestDisabled(d,a,n);if(u){var f=new Date(u);if("start"===e&&u<p||"end"===e&&u>p)var p=f}var l="start"===e?wceb.createDateObject(l):wceb.createDateObject(p),b="start"===e?wceb.createDateObject(p):wceb.createDateObject(b),m=wceb.createDateObject(new Date(l.year,l.month,1));r.min=l,r.max=b,r.view=m,"undefined"!=typeof i&&null!==i||(r.highlight=l),$body.trigger("set_"+e+"_picker",[r,d]),a.render(),wceb.checkIf.datesAreSet()&&wceb.setPrice()}},pickerStart.on({render:function(){pickerStart.$root.find(".picker__header").prepend('<div class="picker__title">'+wceb_object.start_text+"</div>")},set:function(e){"undefined"!=typeof e.clear&&null===e.clear&&("two"===wceb.dateFormat&&(wceb.pickers.clearSecond("start","end",pickerEnd),wceb.checkIf.dateIsSet("end")||$reset_dates.hide()),t.startFormat=null,$body.trigger("clear_start_date")),"two"===wceb.dateFormat&&wceb.checkIf.dateIsSet(e.select)?(wceb.pickers.set("start",pickerStart,pickerEnd,pickerEndItem),$reset_dates.show()):"one"===wceb.dateFormat&&wceb.checkIf.dateIsSet(e.select)&&wceb.picker.set()},close:function(){wceb.picker.close(pickerStart,pickerEnd)}}),pickerEnd.on({render:function(){pickerEnd.$root.find(".picker__header").prepend('<div class="picker__title">'+wceb_object.end_text+"</div>")},set:function(e){return"undefined"!=typeof e.clear&&null===e.clear&&(wceb.pickers.clearSecond("end","start",pickerStart),wceb.checkIf.dateIsSet("start")||$reset_dates.hide(),t.endFormat=null,$body.trigger("clear_end_date")),"two"===wceb.dateFormat&&wceb.checkIf.dateIsSet(e.select)&&(wceb.pickers.set("end",pickerEnd,pickerStart,pickerStartItem),$reset_dates.show()),!1},close:function(){wceb.picker.close(pickerEnd,pickerStart)}}),$body.on("pickers_init",function(e,t){var a=wceb.get.firstAvailableDates(),r=a.start;if(pickerStartItem.view=wceb.createDateObject(new Date(r.year,r.month,1)),pickerStartItem.highlight=r,"two"===wceb.dateFormat){var c=a.end;pickerEndItem.view=wceb.createDateObject(new Date(c.year,c.month,1)),pickerEndItem.highlight=c,pickerEndItem.min=c}return!1}),pickerStart.on("before_rendering",function(){if("two"===wceb.dateFormat){var e=pickerEnd.get("select");startPickerDisabled=pickerStartItem.disable,wceb.checkIf.dateIsSet(e)&&"days"!==wceb.bookingDuration&&wceb.bookingCustomDuration>1&&wceb.applyBookingDuration("start",pickerStartItem,e)}}),pickerStart.on("after_rendering",function(){"two"===wceb.dateFormat&&(pickerStartItem.disable=startPickerDisabled)}),pickerEnd.on("before_rendering",function(){var e=pickerStart.get("select");endPickerDisabled=pickerEndItem.disable,wceb.checkIf.dateIsSet(e)&&"days"!==wceb.bookingDuration&&wceb.bookingCustomDuration>1&&wceb.applyBookingDuration("end",pickerEndItem,e)}),pickerEnd.on("after_rendering",function(){pickerEndItem.disable=endPickerDisabled}),$cart.on("change",'input[name="quantity"]',function(){formatted_price=wceb.formatPrice(wceb.get.basePrice()),$booking_price.find(".price .amount").html(formatted_price),formatted_regular_price=wceb.formatPrice(wceb.get.regularPrice()),$booking_price.find(".price del .amount").html(formatted_regular_price)}),$body.on("update_price",function(){$add_to_cart_button.prop("disabled",!1)}),e(".product-addon input, .product-addon textarea, .product-addon select, .product-addon input.qty, .wc-pao-addon input, .wc-pao-addon textarea, .wc-pao-addon select, .wc-pao-addon input.qty").on("woocommerce-product-addons-update",function(){if("two"===wceb.dateFormat&&wceb.checkIf.datesAreSet())wceb.setPrice();else if("one"===wceb.dateFormat&&wceb.checkIf.dateIsSet("start"))wceb.picker.set();else{var e=wceb.formatPrice(wceb.get.basePrice());$booking_price.find(".price .amount").html(e),formatted_regular_price=wceb.formatPrice(wceb.get.regularPrice()),$booking_price.find(".price del .amount").html(formatted_regular_price)}}),$body.on("clear_start_date clear_end_date",function(){wceb.clearBookingSession()}),$reset_dates.on("click",function(t){t.preventDefault(),wceb.pickers.reset(),wceb.clearBookingSession(),e(this).hide()}).hide()})}(jQuery);